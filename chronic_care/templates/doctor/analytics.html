{% extends 'base.html' %}
{% block content %}
<h3>Disease Analytics</h3>
<div class="row">
  <div class="col-md-6">
    <h6>Total Predictions by Disease</h6>
    <canvas id="byDisease"></canvas>
  </div>
  <div class="col-md-6">
    <h6>Outcomes by Disease</h6>
    <canvas id="byOutcome"></canvas>
  </div>
</div>
<script>
const byDisease = {{ by_disease|safe }};
const byOutcome = {{ by_outcome|safe }};

new Chart(document.getElementById('byDisease'), {
  type: 'bar',
  data: {
    labels: byDisease.map(x => x.disease),
    datasets: [{ label: 'Predictions', data: byDisease.map(x => x.total), backgroundColor: '#0d6efd' }]
  }
});

const diseases = [...new Set(byOutcome.map(x => x.disease))];
const positives = diseases.map(d => (byOutcome.find(x => x.disease === d && x.result === true) || {total: 0}).total);
const negatives = diseases.map(d => (byOutcome.find(x => x.disease === d && x.result === false) || {total: 0}).total);

new Chart(document.getElementById('byOutcome'), {
  type: 'bar',
  data: {
    labels: diseases,
    datasets: [
      { label: 'Positive', data: positives, backgroundColor: '#dc3545' },
      { label: 'Negative', data: negatives, backgroundColor: '#198754' }
    ]
  },
  options: { scales: { x: { stacked: true }, y: { stacked: true } } }
});
</script>
{% endblock %}